(function(){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";function t(e,n){sigma.classes.dispatcher.extend(this);var v=this,m=e,i=document.body,f=n,o=n.container.lastChild,p=n.camera,h=null,x="",t=[],r={},d=!1,b=!1;function a(e){r[e.data.node.id]||(t.push(e.data.node),r[e.data.node.id]=!0,t.length&&!d&&(h=t[t.length-1],o.addEventListener("mousedown",u)))}function s(e){var n=t.map(function(e){return e}).indexOf(e.data.node);t.splice(n,1),delete r[e.data.node.id],t.length&&!d?h=t[t.length-1]:o.removeEventListener("mousedown",u)}function u(e){d=!0;var n=m.graph.nodes().length;if(h&&1<n){var t,r;for(t in o.removeEventListener("mousedown",u),i.addEventListener("mousemove",c),i.addEventListener("mouseup",l),m.cameras)void 0!==(r=m.cameras[t]).edgequadtree&&(r.edgequadtree._enabled=!1);f.settings({mouseEnabled:!1,enableHovering:!1}),m.refresh(),v.dispatchEvent("startdrag",{node:h,captor:e,renderer:f})}}function l(e){var n,t;for(n in d=!1,o.addEventListener("mousedown",u),i.removeEventListener("mousemove",c),i.removeEventListener("mouseup",l),m.cameras)void 0!==(t=m.cameras[n]).edgequadtree&&(t.edgequadtree._enabled=!0);f.settings({mouseEnabled:!0,enableHovering:!0}),m.refresh(),b&&v.dispatchEvent("drop",{node:h,captor:e,renderer:f}),v.dispatchEvent("dragend",{node:h,captor:e,renderer:f}),b=!1,h=null}function c(g){if(-1<navigator.userAgent.toLowerCase().indexOf("firefox")){clearTimeout(e);var e=setTimeout(n,0)}else n();function n(){for(var e=function(e){var n=window.getComputedStyle(e),t=function(e){return parseInt(n.getPropertyValue(e).replace("px",""))||0};return{left:e.getBoundingClientRect().left+t("padding-left"),top:e.getBoundingClientRect().top+t("padding-top")}}(f.container),n=g.clientX-e.left,t=g.clientY-e.top,r=Math.cos(p.angle),i=Math.sin(p.angle),o=m.graph.nodes(),d=[],a=0;a<2;a++){var s=o[a],u={x:s.x*r+s.y*i,y:s.y*r-s.x*i,renX:s[x+"x"],renY:s[x+"y"]};d.push(u)}if(d[0].x===d[1].x&&d[0].y===d[1].y){var l=0===d[0].renX?1:d[0].renX,c=0===d[0].renY?1:d[0].renY;n=d[0].x/l*(n-d[0].renX)+d[0].x,t=d[0].y/c*(t-d[0].renY)+d[0].y}else{l=(d[1].renX-d[0].renX)/(d[1].x-d[0].x),c=(d[1].renY-d[0].renY)/(d[1].y-d[0].y);d[1].x===d[0].x&&(l=c),d[1].y===d[0].y&&(c=l),n=(n-d[0].renX)/l+d[0].x,t=(t-d[0].renY)/c+d[0].y}h.x=n*r-t*i,h.y=t*r+n*i,m.refresh(),b=!0,v.dispatchEvent("drag",{node:h,captor:g,renderer:f})}}n instanceof sigma.renderers.svg&&(o=n.container.firstChild),x=n instanceof sigma.renderers.webgl?n.options.prefix.substr(5):n.options.prefix,n.bind("overNode",a),n.bind("outNode",s),n.bind("click",function(e){d=!1,i.removeEventListener("mousemove",c),i.removeEventListener("mouseup",l),t.length||(h=null)}),m.bind("kill",function(){v.unbindAll()}),this.unbindAll=function(){o.removeEventListener("mousedown",u),i.removeEventListener("mousemove",c),i.removeEventListener("mouseup",l),f.unbind("overNode",a),f.unbind("outNode",s)}}sigma.utils.pkg("sigma.plugins");var r={};sigma.plugins.dragNodes=function(e,n){return r[e.id]||(r[e.id]=new t(e,n)),e.bind("kill",function(){sigma.plugins.killDragNodes(e)}),r[e.id]},sigma.plugins.killDragNodes=function(e){r[e.id]instanceof t&&(r[e.id].unbindAll(),delete r[e.id])}}).call(window);