(function(t){"use strict";var i=[],e=function(t,e,a){i.push({name:t,drawShape:e,drawBorder:a})},a=function(r){return function(t,e,a,i,l,n){n.fillStyle=l,n.beginPath(),r(t,e,a,i,n),n.closePath(),n.fill()}},l=function(r){return function(t,e,a,i,l,n){n.strokeStyle=l,n.lineWidth=i/5,n.beginPath(),r(t,e,a,i,n),n.closePath(),n.stroke()}},n=function(t,e,a,i,l){var n=45*Math.PI/180;l.moveTo(e+i*Math.sin(n),a-i*Math.cos(n));for(var r=1;r<4;r++)l.lineTo(e+Math.sin(n+2*Math.PI*r/4)*i,a-Math.cos(n+2*Math.PI*r/4)*i)};e("square",a(n),l(n));var r=function(t,e,a,i,l){l.arc(e,a,i,0,2*Math.PI,!0)};e("circle",a(r),l(r));var o=function(t,e,a,i,l){l.moveTo(e-i,a),l.lineTo(e,a-i),l.lineTo(e+i,a),l.lineTo(e,a+i)};e("diamond",a(o),l(o));var s=function(t,e,a,i,l){var n=t.cross&&t.cross.lineWeight||5;l.moveTo(e-i,a-n),l.lineTo(e-i,a+n),l.lineTo(e-n,a+n),l.lineTo(e-n,a+i),l.lineTo(e+n,a+i),l.lineTo(e+n,a+n),l.lineTo(e+i,a+n),l.lineTo(e+i,a-n),l.lineTo(e+n,a-n),l.lineTo(e+n,a-i),l.lineTo(e-n,a-i),l.lineTo(e-n,a-n)};e("cross",a(s),l(s));var c=function(t,e,a,i,l){var n=t.equilateral&&t.equilateral.numPoints||5,r=(t.equilateral&&t.equilateral.rotate||0)*Math.PI/180,o=i;l.moveTo(e+o*Math.sin(r),a-o*Math.cos(r));for(var s=1;s<n;s++)l.lineTo(e+Math.sin(r+2*Math.PI*s/n)*o,a-Math.cos(r+2*Math.PI*s/n)*o)};e("equilateral",a(c),l(c));var u=function(t,e,a,i,l){var n=t.star&&t.star.numPoints||5,r=i,o=i*(t.star&&t.star.innerRatio||.5),s=Math.PI/n;l.moveTo(e,a-i);for(var c=0;c<n;c++)l.lineTo(e+Math.sin(s+2*Math.PI*c/n)*o,a-Math.cos(s+2*Math.PI*c/n)*o),l.lineTo(e+Math.sin(2*Math.PI*(c+1)/n)*r,a-Math.cos(2*Math.PI*(c+1)/n)*r)};e("star",a(u),l(u));e("pacman",function(t,e,a,i,l,n){n.fillStyle="yellow",n.beginPath(),n.arc(e,a,i,1.25*Math.PI,0,!1),n.arc(e,a,i,0,.75*Math.PI,!1),n.lineTo(e,a),n.closePath(),n.fill(),n.fillStyle="white",n.strokeStyle="black",n.beginPath(),n.arc(e+i/3,a-i/3,i/4,0,2*Math.PI,!1),n.closePath(),n.fill(),n.stroke(),n.fillStyle="black",n.beginPath(),n.arc(e+4*i/9,a-i/3,i/8,0,2*Math.PI,!1),n.closePath(),n.fill()},null),this.ShapeLibrary={enumerate:function(){return i},version:"0.1"}}).call(this),function(t){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";if("undefined"==typeof ShapeLibrary)throw"ShapeLibrary is not declared";sigma.utils.pkg("sigma.canvas.nodes"),sigma.utils.pkg("sigma.svg.nodes");var m=t,g={},e=function(t,c,u){sigma.canvas.nodes[t]=function(t,e,a){var i=a("prefix")||"",l=t[i+"size"],n=t.color||a("defaultNodeColor"),r=t.borderColor||n,o=t[i+"x"],s=t[i+"y"];e.save(),c&&c(t,o,s,l,n,e),u&&u(t,o,s,l,r,e),function(t,e,a,i,l){if(m&&t.image&&t.image.url){var n=t.image.url,r=t.image.h||1,o=t.image.w||1,s=t.image.scale||1,c=t.image.clip||1,u=g[n];u||((u=document.createElement("IMG")).src=n,u.status="loading",u.onerror=function(){console.log("error loading",n),u.status="error"},u.onload=function(){console.log("redraw on image load",n),u.status="ok",m.refresh()},g[n]=u);var h=o<r?o/r:1,d=r<o?r/o:1,f=i*s;l.save(),l.beginPath(),l.arc(e,a,i*c,0,2*Math.PI,!0),l.closePath(),l.clip(),"ok"===u.status&&l.drawImage(u,e+Math.sin(-.7855)*f*h,a-Math.cos(-.7855)*f*d,f*h*2*Math.sin(-.7855)*-1,f*d*2*Math.cos(-.7855)),l.restore()}}(t,o,s,l,e),e.restore()},sigma.svg.nodes[t]={create:function(t,e){var a=document.createElementNS(e("xmlns"),"g"),i=document.createElementNS(e("xmlns"),"circle");return a.setAttributeNS(null,"class",e("classPrefix")+"-node-group"),a.setAttributeNS(null,"data-node-id",t.id),i.setAttributeNS(null,"data-node-id",t.id),i.setAttributeNS(null,"class",e("classPrefix")+"-node"),i.setAttributeNS(null,"fill",t.color||e("defaultNodeColor")),a.appendChild(i),function(t,e,a){if(m&&t.image&&t.image.url){var i=document.createElementNS(a("xmlns"),"circle"),l=document.createElementNS(a("xmlns"),"clipPath"),n=a("classPrefix")+"-clip-path-"+t.id,r=document.createElementNS(a("xmlns"),"defs"),o=document.createElementNS(a("xmlns"),"image");t.image.url,l.setAttributeNS(null,"id",n),l.appendChild(i),r.appendChild(l);var s=/MSIE [5-9]/.test(navigator.userAgent)?"":document.location.href;s=s.split("#")[0],o.setAttributeNS(null,"class",a("classPrefix")+"-node-image"),o.setAttributeNS(null,"clip-path","url("+s+"#"+n+")"),o.setAttributeNS(null,"pointer-events","none"),o.setAttributeNS("http://www.w3.org/1999/xlink","href",t.image.url),e.appendChild(r),e.appendChild(o)}}(t,a,e),a},update:function(t,e,a){for(var i=a("classPrefix"),l=t.image.clip||1,n=t.image.h||1,r=t.image.w||1,o=a("prefix")||"",s=t.image.scale||1,c=t[o+"size"],u=t[o+"x"],h=t[o+"y"],d=s*c,f=r<n?r/n:1,m=n<r?n/r:1,g=0,S=e.childNodes;g<S.length;g++){switch(S[g].getAttribute("class")){case i+"-node":S[g].setAttributeNS(null,"cx",u),S[g].setAttributeNS(null,"cy",h),S[g].setAttributeNS(null,"r",c),a("freeStyle")||S[g].setAttributeNS(null,"fill",t.color||a("defaultNodeColor"));break;case i+"-node-image":S[g].setAttributeNS(null,"x",u+Math.sin(-.7855)*d*f),S[g].setAttributeNS(null,"y",h-Math.cos(-.7855)*d*m),S[g].setAttributeNS(null,"width",d*f*2*Math.sin(-.7855)*-1),S[g].setAttributeNS(null,"height",d*m*2*Math.cos(-.7855));break;default:var p=S[g].firstChild;if(null!=p){var M=i+"-clip-path-"+t.id;p.getAttribute("id")===M&&(p.firstChild.setAttributeNS(null,"cx",u),p.firstChild.setAttributeNS(null,"cy",h),p.firstChild.setAttributeNS(null,"r",l*c))}}}e.style.display=""}}};ShapeLibrary.enumerate().forEach(function(t){e(t.name,t.drawShape,t.drawBorder)}),this.CustomShapes={init:function(t){m=t},version:"0.1"}}.call(this);